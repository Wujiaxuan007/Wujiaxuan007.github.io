<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™„ä»¶è‡ªåŠ¨æ¨¡æ¿åŒ–é…ç½®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: #fafafa;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .switch-label {
            font-size: 16px;
            font-weight: 500;
            color: #262626;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 22px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 22px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #1890ff;
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        .config-content-wrapper {
            display: none;
        }

        .config-content-wrapper.show {
            display: block;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title .tooltip {
            width: 450px;
            bottom: auto;
            top: calc(100% + 8px);
        }

        .section-title .tooltip::after {
            top: auto;
            bottom: 100%;
            border-top-color: transparent;
            border-bottom-color: #333;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 18px;
            background: #1890ff;
            border-radius: 2px;
        }

        .section-subtitle {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            color: #595959;
            margin-top: 25px;
        }

        .config-group {
            background: #fafafa;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .config-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .config-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .config-label {
            flex: 0 0 auto;
            min-width: 240px;
            font-weight: 500;
            color: #262626;
            margin-right: 20px;
            white-space: nowrap;
        }

        .config-label .required {
            color: #ff4d4f;
            margin-left: 4px;
        }

        .config-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .config-description {
            display: none;
        }

        .help-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            line-height: 16px;
            text-align: center;
            border-radius: 50%;
            background: #e6f7ff;
            color: #1890ff;
            font-size: 12px;
            cursor: help;
            margin-left: 6px;
            vertical-align: middle;
            position: relative;
        }

        .help-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        .tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            text-align: left;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 13px;
            white-space: normal;
            width: 320px;
            max-width: 90vw;
            z-index: 1000;
            transition: opacity 0.3s, visibility 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            line-height: 1.6;
            word-wrap: break-word;
        }

        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
        }

        .help-icon {
            position: relative;
        }

        .config-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="number"] {
            width: 150px;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .config-unit {
            color: #8c8c8c;
            font-size: 14px;
        }


        .tips-box {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            margin-bottom: 20px;
        }

        .tips-title {
            font-weight: 600;
            color: #0050b3;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tips-title::before {
            content: 'ğŸ’¡';
            font-size: 16px;
        }

        .tips-content {
            color: #0050b3;
            font-size: 14px;
            line-height: 1.8;
        }

        .tips-content ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .tips-content li {
            margin-bottom: 6px;
        }

        .divider {
            height: 1px;
            background: #e8e8e8;
            margin: 30px 0;
        }

        .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e8e8e8;
        }

        button {
            padding: 8px 24px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #1890ff;
            color: white;
        }

        .btn-primary:hover {
            background: #40a9ff;
        }

        .btn-default {
            background: white;
            color: #262626;
            border: 1px solid #d9d9d9;
        }

        .btn-default:hover {
            border-color: #40a9ff;
            color: #40a9ff;
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- æ€»å¼€å…³ -->
        <div class="switch-container">
            <span class="switch-label">é™„ä»¶è‡ªåŠ¨æ¨¡æ¿åŒ–å¼€å…³</span>
            <label class="switch">
                <input type="checkbox" id="mainSwitch" onchange="toggleConfig()">
                <span class="slider"></span>
            </label>
        </div>

        <!-- é…ç½®å†…å®¹ -->
        <div class="config-content-wrapper" id="configContent">
        <!-- ä¸€ã€é™„ä»¶æ¨¡ç‰ˆåŒ–è§¦å‘ä¿å­˜æ¡ä»¶ -->
        <div class="section">
            <div class="section-title">
                é™„ä»¶æ¨¡ç‰ˆåŒ–è§¦å‘ä¿å­˜æ¡ä»¶
                <span class="help-icon">?
                    <span class="tooltip">
                        è¡¨æ ¼é™„ä»¶ vs éè¡¨æ ¼é™„ä»¶çš„åŒºåˆ«ï¼š<br><br>
                        <strong>è¡¨æ ¼é™„ä»¶ï¼ˆExcelç­‰ï¼‰ï¼š</strong><br>
                        ç»“æ„æ¸…æ™°ï¼Œå¯ç›´æ¥è¯»å–åˆ—åå’Œæ•°æ®ç»“æ„ï¼Œå¤„ç†æ•ˆç‡é«˜ï¼Œé€‚åˆæ¨¡æ¿åŒ–ã€‚<br><br>
                        <strong>éè¡¨æ ¼é™„ä»¶ï¼ˆPDF/å›¾ç‰‡/æ–‡æ¡£ç­‰ï¼‰ï¼š</strong><br>
                        éœ€è¦è°ƒç”¨ LLM æå–ç»“æ„ä¿¡æ¯ï¼Œå¤„ç†æˆæœ¬è¾ƒé«˜ã€‚å¯¹äºç®€å•ä»»åŠ¡ï¼Œæ¨¡æ¿åŒ–çš„ä¼˜åŒ–æ•ˆæœæœ‰é™ï¼Œå› æ­¤éœ€è¦æ›´é«˜çš„è§¦å‘é˜ˆå€¼ï¼ˆâ‰¥2æ¬¡å·¥å…·è°ƒç”¨ï¼‰æ‰ä¿å­˜ä¸ºä¸´æ—¶æ¨¡æ¿ï¼Œé¿å…ä¸ºç®€å•ä»»åŠ¡åˆ›å»ºä¸å¿…è¦çš„æ¨¡æ¿ã€‚
                    </span>
                </span>
            </div>
            <!-- <div class="section-subtitle">Attachment Handling Rules</div> -->
            
            <div class="config-group">
                <div class="config-item">
                    <div class="config-label">
                        è¡¨æ ¼ç±»é™„ä»¶è§¦å‘æ¡ä»¶
                        <span class="required">*</span>
                        <span class="help-icon">?
                            <span class="tooltip">è¯´æ˜ï¼šå½“ä¸Šä¼ çš„ <strong>è¡¨æ ¼é™„ä»¶</strong> åœ¨å¤„ç†è¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨çš„å·¥å…·æ•°é‡ <strong>è¶…è¿‡è¯¥å€¼</strong> æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜ä¸ºä¸´æ—¶æ¨¡æ¿ã€‚</span>
                        </span>
                    </div>
                    <div class="config-content">
                        <div class="config-input-group">
                            <input type="number" id="excel_tool_threshold" value="1" min="0" step="1">
                            <span class="config-unit">æ¬¡</span>
                        </div>
                    </div>
                </div>

                <div class="config-item">
                    <div class="config-label">
                        éè¡¨æ ¼ç±»é™„ä»¶è§¦å‘æ¡ä»¶
                        <span class="required">*</span>
                        <span class="help-icon">?
                            <span class="tooltip">è¯´æ˜ï¼šå½“é™„ä»¶ä¸º <strong>éè¡¨æ ¼ç±»å‹ï¼ˆPDF / å›¾ç‰‡ / æ–‡æ¡£ç­‰ï¼‰</strong>ï¼Œåœ¨å¤„ç†è¿‡ç¨‹ä¸­è°ƒç”¨çš„å·¥å…·æ•°é‡ <strong>å¤§äºæˆ–ç­‰äºè¯¥å€¼</strong> æ—¶ï¼Œä¼šè‡ªåŠ¨ä¿å­˜ä¸ºä¸´æ—¶æ¨¡æ¿ã€‚</span>
                        </span>
                    </div>
                    <div class="config-content">
                        <div class="config-input-group">
                            <input type="number" id="non_excel_tool_threshold" value="2" min="0" step="1">
                            <span class="config-unit">æ¬¡</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="divider"></div>

        <!-- äºŒã€ä¸´æ—¶æ¨¡æ¿è½¬æŒä¹…åŒ–ç­–ç•¥ -->
        <div class="section">
            <div class="section-title">
                ä¸´æ—¶æ¨¡æ¿è½¬æŒä¹…åŒ–ç­–ç•¥
                <span class="help-icon">?
                    <span class="tooltip">
                        ä¸´æ—¶æ¨¡æ¿ç”¨äºè§‚å¯Ÿé™„ä»¶å¤„ç†æ¨¡å¼ï¼Œåªæœ‰è¢«å¤šæ¬¡ä½¿ç”¨çš„æ‰ä¼šè½¬ä¸ºæŒä¹…åŒ–æ¨¡æ¿ï¼Œé¿å…ä¸ºä¸€æ¬¡æ€§éœ€æ±‚åˆ›å»ºä¸å¿…è¦çš„æ¨¡æ¿ã€‚
                    </span>
                </span>
            </div>
            <!-- <div class="section-subtitle">Temporary Template â†’ Persistent Template Policy</div> -->
            
            <div class="config-group">
                <div class="config-item" style="align-items: flex-start;">
                    <div class="config-content" style="flex: 1; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                        <!-- <span class="required">*</span>
                        <span class="help-icon">?
                            <span class="tooltip">è¯´æ˜ï¼šåœ¨ç»Ÿè®¡å‘¨æœŸå†…ï¼Œä¸´æ—¶æ¨¡æ¿è¢«ä½¿ç”¨çš„æ¬¡æ•° <strong>è¶…è¿‡è¯¥å€¼</strong> æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬ä¸ºæŒä¹…åŒ–æ¨¡æ¿ã€‚ç»Ÿè®¡å‘¨æœŸå†…çš„ä½¿ç”¨æ¬¡æ•°å°†ä½œä¸ºæ˜¯å¦å‡çº§ä¸ºæŒä¹…åŒ–æ¨¡æ¿çš„ä¾æ®ã€‚</span>
                        </span> -->
                        <div class="config-input-group" style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                            <input type="number" id="temp_template_stat_days" value="15" min="1" step="1" style="width: 80px;">
                            <span>å¤©å†…ï¼Œä¸´æ—¶æ¨¡ç‰ˆä½¿ç”¨æ¬¡æ•°è¶…è¿‡</span>
                            <input type="number" id="temp_template_usage_threshold" value="3" min="1" step="1" style="width: 80px;">
                            <span>æ¬¡è‡ªåŠ¨æŒä¹…åŒ–ï¼Œä¸æ»¡è¶³çš„ä¼šè‡ªåŠ¨æ¸…ç†</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="divider"></div>

        <!-- ä¸‰ã€æŒä¹…åŒ–æ¨¡æ¿æ¸…ç†è§„åˆ™ -->
        <div class="section">
            <div class="section-title">æŒä¹…åŒ–æ¨¡æ¿æ¸…ç†è§„åˆ™</div>
            <!-- <div class="section-subtitle">Persistent Template Cleanup Rules</div> -->
            
            <div class="config-group">
                <div class="config-item">
                    <div class="config-label">
                        ä¸æ´»è·ƒè‡ªåŠ¨æ¸…ç†å¤©æ•°
                        <span class="required">*</span>
                        <span class="help-icon">?
                            <span class="tooltip">è¯´æ˜ï¼šæŒä¹…åŒ–æ¨¡æ¿åœ¨æŒç»­è¶…è¿‡è¯¥å¤©æ•°æœªè¢«ä½¿ç”¨æ—¶ï¼Œä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨æ¸…ç†ï¼Œä»¥å‡å°‘æ—§æ¨¡æ¿å¯¹ç³»ç»Ÿçš„å¹²æ‰°ã€‚</span>
                        </span>
                    </div>
                    <div class="config-content">
                        <div class="config-input-group">
                            <input type="number" id="persistent_template_expire_days" value="30" min="1" step="1">
                            <span class="config-unit">å¤©</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æŒ‰é’®ç»„ -->
        <div class="button-group">
            <button class="btn-primary" onclick="saveConfig()">ä¿å­˜</button>
        </div>
        </div>
    </div>

    <script>
        // åˆ‡æ¢é…ç½®æ˜¾ç¤º/éšè—
        function toggleConfig() {
            const switchEl = document.getElementById('mainSwitch');
            const contentEl = document.getElementById('configContent');
            if (switchEl.checked) {
                contentEl.classList.add('show');
            } else {
                contentEl.classList.remove('show');
            }
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            const config = {
                excel_tool_threshold: parseInt(document.getElementById('excel_tool_threshold').value),
                non_excel_tool_threshold: parseInt(document.getElementById('non_excel_tool_threshold').value),
                temp_template_usage_threshold: parseInt(document.getElementById('temp_template_usage_threshold').value),
                temp_template_stat_days: parseInt(document.getElementById('temp_template_stat_days').value),
                persistent_template_expire_days: parseInt(document.getElementById('persistent_template_expire_days').value)
            };

            // éªŒè¯é…ç½®
            if (config.excel_tool_threshold < 0 || 
                config.non_excel_tool_threshold < 0 ||
                config.temp_template_usage_threshold < 1 ||
                config.temp_template_stat_days < 1 ||
                config.persistent_template_expire_days < 1) {
                alert('è¯·æ£€æŸ¥é…ç½®é¡¹ï¼Œç¡®ä¿æ‰€æœ‰å€¼éƒ½ç¬¦åˆè¦æ±‚ï¼');
                return;
            }

            // è¿™é‡Œå¯ä»¥è°ƒç”¨ API ä¿å­˜é…ç½®
            console.log('ä¿å­˜é…ç½®:', config);
            
            // ç¤ºä¾‹ï¼šå‘é€åˆ°åç«¯ API
            // fetch('/api/ai/template-config', {
            //     method: 'POST',
            //     headers: {
            //         'Content-Type': 'application/json',
            //     },
            //     body: JSON.stringify(config)
            // })
            // .then(response => response.json())
            // .then(data => {
            //     alert('é…ç½®ä¿å­˜æˆåŠŸï¼');
            // })
            // .catch(error => {
            //     console.error('Error:', error);
            //     alert('é…ç½®ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            // });

            alert('é…ç½®ä¿å­˜æˆåŠŸï¼\n\n' + JSON.stringify(config, null, 2));
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿ')) {
                document.getElementById('excel_tool_threshold').value = 1;
                document.getElementById('non_excel_tool_threshold').value = 2;
                document.getElementById('temp_template_usage_threshold').value = 3;
                document.getElementById('temp_template_stat_days').value = 15;
                document.getElementById('persistent_template_expire_days').value = 30;
            }
        }

        // é¡µé¢åŠ è½½æ—¶ï¼Œå¯ä»¥ä»åç«¯è·å–é…ç½®
        window.addEventListener('DOMContentLoaded', function() {
            // é»˜è®¤å…³é—­çŠ¶æ€
            const switchEl = document.getElementById('mainSwitch');
            switchEl.checked = false;
            toggleConfig();
            
            // ç¤ºä¾‹ï¼šä»åç«¯åŠ è½½é…ç½®
            // fetch('/api/ai/template-config')
            //     .then(response => response.json())
            //     .then(data => {
            //         if (data.success && data.data) {
            //             const config = data.data;
            //             document.getElementById('mainSwitch').checked = config.enabled || false;
            //             toggleConfig();
            //             document.getElementById('excel_tool_threshold').value = config.excel_tool_threshold || 1;
            //             document.getElementById('non_excel_tool_threshold').value = config.non_excel_tool_threshold || 2;
            //             document.getElementById('temp_template_usage_threshold').value = config.temp_template_usage_threshold || 3;
            //             document.getElementById('temp_template_stat_days').value = config.temp_template_stat_days || 15;
            //             document.getElementById('persistent_template_expire_days').value = config.persistent_template_expire_days || 30;
            //         }
            //     })
            //     .catch(error => {
            //         console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
            //     });
        });
    </script>
</body>
</html>

